{
  "version": "5.0.1-beta.4",
  "timestamp": "2026-02-17T00:00:00Z",
  "skillSet": "comments",
  "hasDeltas": true,
  "deltas": [
    {
      "id": "delta-001",
      "type": "new_feature",
      "releaseNoteText": "Private Mode API — `enablePrivateMode(config: PrivateModeConfig)` and `disablePrivateMode()` methods on `commentElement` for global comment visibility control",
      "releaseNoteVersion": "5.0.1-beta.4",
      "skillTarget": "comments",
      "action": "create_rule",
      "targetFile": "rules/shared/permissions/permissions-private-mode.md",
      "targetSection": null,
      "summary": "Create a new rule documenting the private comments visibility system: the `enablePrivateMode(config)` and `disablePrivateMode()` methods on `commentElement`, the `updateVisibility(config)` method for per-annotation control, the `CommentVisibilityType` enum values (`'public'`, `'organizationPrivate'`, `'restricted'`), and the `PrivateModeConfig` and `CommentVisibilityConfig` type shapes. This rule replaces the stub note in `permissions/README.md` that private comments 'can be marked as private' but lacked API detail.",
      "details": {
        "apiName": "enablePrivateMode / disablePrivateMode / updateVisibility",
        "apiType": "method",
        "signature": "enablePrivateMode(config: PrivateModeConfig): void\ndisablePrivateMode(): void\nupdateVisibility(config: CommentVisibilityConfig): void",
        "parameters": [
          {
            "name": "config",
            "type": "PrivateModeConfig",
            "required": true,
            "description": "Visibility configuration for global private mode. PrivateModeConfig = Omit<CommentVisibilityConfig, 'annotationId' | 'organizationId'>. Accepts `type` and `userIds` only.",
            "parentMethod": "enablePrivateMode"
          },
          {
            "name": "config",
            "type": "CommentVisibilityConfig",
            "required": true,
            "description": "Visibility configuration for a specific annotation. Includes `type: CommentVisibilityType`, optional `userIds: string[]`, `annotationId: string`, and `organizationId: string` (auto-resolved).",
            "parentMethod": "updateVisibility"
          }
        ],
        "returnType": "void",
        "types": {
          "CommentVisibilityType": "'public' | 'organizationPrivate' | 'restricted'",
          "PrivateModeConfig": "Omit<CommentVisibilityConfig, 'annotationId' | 'organizationId'>",
          "CommentVisibilityConfig": "{ type: CommentVisibilityType; userIds?: string[]; annotationId?: string; organizationId?: string; }"
        },
        "codeExample": "// React: Enable global private mode for organization members only\nconst { client } = useVeltClient();\nuseEffect(() => {\n  if (!client) return;\n  const commentElement = client.getCommentElement();\n  commentElement.enablePrivateMode({ type: 'organizationPrivate' });\n  return () => commentElement.disablePrivateMode();\n}, [client]);\n\n// React: Restrict new comments to specific users only\ncommentElement.enablePrivateMode({\n  type: 'restricted',\n  userIds: ['user-a', 'user-b']\n});\n\n// React: Update visibility of a specific annotation\ncommentElement.updateVisibility({\n  annotationId: 'annotation-123',\n  type: 'organizationPrivate'\n});\n\n// Other Frameworks: Global private mode\nconst commentElement = Velt.getCommentElement();\ncommentElement.enablePrivateMode({ type: 'organizationPrivate' });\ncommentElement.disablePrivateMode();\n\n// Other Frameworks: Per-annotation visibility\ncommentElement.updateVisibility({\n  annotationId: 'annotation-123',\n  type: 'restricted',\n  userIds: ['user-a']\n});"
      },
      "confidence": "high",
      "ambiguityNote": null
    },
    {
      "id": "delta-002",
      "type": "breaking_change",
      "releaseNoteText": "`CommentVisibilityType` values renamed: `'organization'` → `'organizationPrivate'`, `'self'` → `'restricted'`",
      "releaseNoteVersion": "5.0.1-beta.4",
      "skillTarget": "comments",
      "action": "update_rule",
      "targetFile": "rules/shared/permissions/permissions-private-mode.md",
      "targetSection": "Breaking Change: CommentVisibilityType Value Renames",
      "summary": "Within the new permissions-private-mode rule (created in delta-001), include a breaking change callout documenting the rename of `CommentVisibilityType` string literal values: `'organization'` is now `'organizationPrivate'` and `'self'` is now `'restricted'`. Any code that passes `type: 'organization'` or `type: 'self'` to `updateVisibility()` or `enablePrivateMode()` will break silently or fail to apply correct visibility. The migration note must show Before/After examples and warn developers to audit all `updateVisibility()` call sites.",
      "details": {
        "apiName": "CommentVisibilityType",
        "apiType": "prop",
        "signature": "type CommentVisibilityType = 'public' | 'organizationPrivate' | 'restricted'",
        "parameters": [],
        "returnType": null,
        "codeExample": "// BEFORE (v5.0.1-beta.3 and earlier — now broken)\ncommentElement.updateVisibility({ annotationId: 'a1', type: 'organization' }); // WRONG\ncommentElement.updateVisibility({ annotationId: 'a1', type: 'self' });         // WRONG\ncommentElement.enablePrivateMode({ type: 'organization' });                    // WRONG\n\n// AFTER (v5.0.1-beta.4+)\ncommentElement.updateVisibility({ annotationId: 'a1', type: 'organizationPrivate' }); // CORRECT\ncommentElement.updateVisibility({ annotationId: 'a1', type: 'restricted' });          // CORRECT\ncommentElement.enablePrivateMode({ type: 'organizationPrivate' });                    // CORRECT"
      },
      "confidence": "high",
      "ambiguityNote": null
    },
    {
      "id": "delta-003",
      "type": "new_feature",
      "releaseNoteText": "`commentSaved` Event — new event emitted after comment persistence, with `CommentSavedEvent` payload",
      "releaseNoteVersion": "5.0.1-beta.4",
      "skillTarget": "comments",
      "action": "create_rule",
      "targetFile": "rules/shared/permissions/permissions-comment-saved-event.md",
      "targetSection": null,
      "summary": "Create a new rule documenting the `commentSaved` event, which fires after a comment annotation is successfully persisted to the database. Document the `CommentSavedEvent` payload interface (`annotationId: string`, `commentAnnotation: CommentAnnotation`, `metadata: VeltEventMetadata`) and show both the React hook pattern (`useCommentEventCallback('commentSaved')`) and the non-React subscription pattern. Clarify that this event fires after write confirmation, making it reliable for side-effects such as triggering webhooks, logging, or syncing external systems.",
      "details": {
        "apiName": "commentSaved",
        "apiType": "event",
        "signature": "commentSaved: CommentSavedEvent",
        "parameters": [],
        "returnType": null,
        "types": {
          "CommentSavedEvent": "{ annotationId: string; commentAnnotation: CommentAnnotation; metadata: VeltEventMetadata; }"
        },
        "codeExample": "// React: Subscribe using useCommentEventCallback\nimport { useCommentEventCallback } from '@veltdev/react';\nimport { useEffect } from 'react';\n\nfunction CommentSaveListener() {\n  const savedEvent = useCommentEventCallback('commentSaved');\n\n  useEffect(() => {\n    if (savedEvent) {\n      console.log('Comment persisted, annotationId:', savedEvent.annotationId);\n      console.log('Full annotation:', savedEvent.commentAnnotation);\n      // Trigger webhook, log analytics, sync external system\n    }\n  }, [savedEvent]);\n\n  return null;\n}\n\n// Other Frameworks: Subscribe via commentElement\nconst commentElement = Velt.getCommentElement();\ncommentElement.on('commentSaved').subscribe((event) => {\n  console.log('Comment persisted, annotationId:', event.annotationId);\n  console.log('Full annotation:', event.commentAnnotation);\n});"
      },
      "confidence": "high",
      "ambiguityNote": null
    }
  ],
  "itemsEvaluated": [
    {
      "text": "Private Mode API — `enablePrivateMode(config: PrivateModeConfig)` and `disablePrivateMode()` methods on `commentElement` for global comment visibility control",
      "category": "Comments",
      "qualifies": true,
      "rationale": "New methods on `commentElement` with explicit signatures. No existing skill rule covers `enablePrivateMode`, `disablePrivateMode`, or `updateVisibility`. The permissions/README.md only notes that 'private comments can be marked as private' with no API detail. A new rule is warranted."
    },
    {
      "text": "`CommentVisibilityType` values renamed: `'organization'` → `'organizationPrivate'`, `'self'` → `'restricted'`",
      "category": "Comments",
      "qualifies": true,
      "rationale": "Breaking change. String literal values of a type that is passed as a required parameter to `updateVisibility()` and `enablePrivateMode()` have changed. Any developer using the old values will pass invalid data silently. No existing skill rule currently documents these values, but the new permissions-private-mode rule (delta-001) must document the correct current values and include a migration callout. Recorded as delta-002 as an update to that same new file."
    },
    {
      "text": "`commentSaved` Event — new event emitted after comment persistence, with `CommentSavedEvent` payload",
      "category": "Comments",
      "qualifies": true,
      "rationale": "New event with explicit name and a documented payload interface. No existing skill rule covers comment lifecycle events or post-save hooks. Event-driven side-effects (webhooks, external sync, analytics) are a distinct developer use case warranting a dedicated rule."
    },
    {
      "text": "New Types — `PrivateModeConfig = Omit<CommentVisibilityConfig, 'annotationId' | 'organizationId'>` and `CommentSavedEvent { annotationId, commentAnnotation, metadata }`",
      "category": "Comments",
      "qualifies": false,
      "rationale": "Type definitions alone are not standalone deltas — they are fully covered as part of delta-001 (PrivateModeConfig documented in enablePrivateMode parameters) and delta-003 (CommentSavedEvent documented in the commentSaved event rule). No separate delta needed."
    },
    {
      "text": "Assign dropdown rendered via CDK Overlay (UI-only, no API change)",
      "category": "Comments",
      "qualifies": false,
      "rationale": "Internal rendering change. No API, prop, wireframe name, or documented behavior changed. Guardrails explicitly exclude UI-only changes without API surface changes."
    },
    {
      "text": "Auto-resolution of `organizationId` for `organizationPrivate` visibility",
      "category": "Comments",
      "qualifies": false,
      "rationale": "Internal behavior improvement with no new API parameter. The `organizationId` field is still part of `CommentVisibilityConfig` but is now optional and auto-resolved. This is captured as a detail note within delta-001 (the `organizationId` parameter is already marked optional in the type definition). No separate delta needed."
    },
    {
      "text": "Bug Fixes (dark mode toggle, composer placeholder, emoji SVG, priority dropdown)",
      "category": "Comments",
      "qualifies": false,
      "rationale": "Four bug fixes restoring prior behavior. No new API methods, props, hooks, events, parameters, or wireframe names introduced. All are internal behavioral corrections. Guardrails explicitly exclude bug fixes unless they change documented behavior taught by a skill rule."
    },
    {
      "text": "Notifications and CRDT feature areas",
      "category": "None",
      "qualifies": false,
      "rationale": "Zero changes to Notifications or CRDT in this release. Both skill sets require no updates."
    }
  ]
}
