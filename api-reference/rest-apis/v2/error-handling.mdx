# REST API v2 Error Handling Guide

This guide provides detailed information about error and success response codes, messages, and schemas for Velt REST API v2.

## Response Format

All API responses follow a consistent format depending on the operation result:

### Success Response Format

```json
{
  "result": {
    "status": "success",
    "message": "Operation completed successfully.",
    "data": {
      // Response data here
    }
  }
}
```

### Error Response Format

```json
{
  "error": {
    "message": "Detailed error message",
    "status": "ERROR_CODE",
    "details": {
      // Additional error details (when available)
    }
  }
}
```

## HTTP Status Codes

### Success Status Codes
- **200 OK**: Request completed successfully
- **201 Created**: Resource created successfully
- **202 Accepted**: Request accepted for processing

### Error Status Codes
- **400 Bad Request**: Invalid request parameters or payload
- **401 Unauthorized**: Authentication required or invalid credentials
- **403 Forbidden**: Insufficient permissions to access resource
- **404 Not Found**: Requested resource does not exist
- **409 Conflict**: Resource already exists or conflicting state
- **422 Unprocessable Entity**: Request validation failed
- **429 Too Many Requests**: Rate limit exceeded
- **500 Internal Server Error**: Server error or batch operation with partial failures

## Batch Operations Error Handling

For operations that process multiple entities (like creating multiple organizations or users), the API uses a special error handling approach:

### When All Operations Succeed
```json
{
  "result": {
    "status": "success",
    "message": "All entities processed successfully.",
    "data": {
      "entity1Id": {
        "success": true,
        "id": "generated_id_123",
        "message": "Created successfully"
      },
      "entity2Id": {
        "success": true,
        "id": "generated_id_456", 
        "message": "Created successfully"
      }
    }
  }
}
```

### When Some Operations Fail (HTTP 500)
When processing an array of entities, if any entity fails validation or processing, the API returns HTTP status 500 with detailed information about which operations succeeded and which failed:

```json
{
  "error": {
    "message": "Some entities failed to process",
    "status": "PARTIAL_FAILURE",
    "data": {
      "successfulEntity1": {
        "success": true,
        "id": "generated_id_123",
        "message": "Created successfully"
      },
      "failedEntity2": {
        "success": false,
        "message": "Validation failed: email is required",
        "errors": {
          "email": ["Email field is required"]
        }
      }
    }
  }
}
```

## Common Error Codes

### Authentication Errors
- **UNAUTHORIZED**: Invalid or missing API key
- **INVALID_AUTH_TOKEN**: Invalid or expired auth token
- **INSUFFICIENT_PERMISSIONS**: User lacks required permissions

### Validation Errors
- **INVALID_ARGUMENT**: Required parameters missing or invalid
- **VALIDATION_FAILED**: Request validation failed
- **INVALID_FORMAT**: Data format is incorrect
- **MISSING_REQUIRED_FIELD**: Required field not provided

### Resource Errors
- **NOT_FOUND**: Requested resource does not exist
- **ALREADY_EXISTS**: Resource already exists
- **RESOURCE_CONFLICT**: Operation conflicts with current resource state

### System Errors
- **INTERNAL_ERROR**: Unexpected server error
- **SERVICE_UNAVAILABLE**: Service temporarily unavailable
- **RATE_LIMIT_EXCEEDED**: API rate limit exceeded

## Error Response Examples

### Single Entity Error
```json
{
  "error": {
    "message": "User creation failed: email is required",
    "status": "VALIDATION_FAILED",
    "details": {
      "field": "email",
      "code": "MISSING_REQUIRED_FIELD"
    }
  }
}
```

### Validation Error with Field Details
```json
{
  "error": {
    "message": "Request validation failed",
    "status": "VALIDATION_FAILED",
    "details": {
      "errors": {
        "email": ["Email format is invalid"],
        "name": ["Name cannot be empty"],
        "organizationId": ["Organization ID is required"]
      }
    }
  }
}
```

### Authentication Error
```json
{
  "error": {
    "message": "Authentication failed: Invalid or expired auth token",
    "status": "INVALID_AUTH_TOKEN"
  }
}
```

### Resource Not Found Error
```json
{
  "error": {
    "message": "Organization not found with ID: invalid_org_id",
    "status": "NOT_FOUND",
    "details": {
      "resource": "organization",
      "id": "invalid_org_id"
    }
  }
}
```

## Best Practices for Error Handling

1. **Always check the HTTP status code** first to determine the general category of response
2. **Parse the response body** to get detailed error information
3. **Handle batch operation errors specially** - check individual entity results in the data object
4. **Implement retry logic** for 5xx errors and rate limiting (429)
5. **Log error details** for debugging and monitoring
6. **Display user-friendly messages** based on error codes rather than raw error messages

## Migration Notes

If you're migrating from API v1:
- Error response format has changed to be more structured
- Batch operations now return detailed success/failure information for each entity
- Error codes are more specific and actionable
- HTTP status codes follow REST conventions more strictly

For more information about specific endpoints and their error responses, refer to the individual API documentation pages.