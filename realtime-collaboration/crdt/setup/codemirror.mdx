---
title: CodeMirror Editor
description: Setup Multiplayer Editing for CodeMirror Editor.
---

The `@veltdev/codemirror-crdt-react` library enables real-time collaborative editing on CodeMirror Editors. The collaboration editing engine is built on top of [Yjs](https://docs.yjs.dev/) and Velt SDK.

## Prerequisites

- Node.js (v14 or higher)
- React (v16.8 or higher for hooks)
- A Velt account with an API key ([sign up](https://console.velt.dev/))
- Optional: TypeScript for type safety

## Setup

### Step 1: Install Dependencies

Install the required packages:

<Tabs>
<Tab title="React / Next.js">

```bash
npm install @veltdev/codemirror-crdt-react @veltdev/react
```

</Tab>
<Tab title="Other Frameworks">

```bash
npm install @veltdev/codemirror-crdt @veltdev/client y-codemirror.next
```

</Tab>
</Tabs>

### Step 2: Setup Velt

Initialize the Velt client by following the [Velt Setup Docs](/get-started/quickstart). This is required for the collaboration engine to work.

### Step 3: Initialize Velt CRDT Extension

- Initialize the Velt CRDT extension and use it to initialize the CodeMirror editor.
- Pass an `editorId` to uniquely identify each editor instance you have in your app. This is especially important when you have multiple editors in your app.


<Tabs>
<Tab title="React / Next.js">

```jsx
// Initialize the Velt CRDT extension
const { store, isLoading } = useVeltCodeMirrorCrdtExtension({ editorId });

useEffect(() => {
  if (!store || !editorRef.current) return;

  const startState = EditorState.create({
    doc: store.getYText()?.toString() ?? '',
    extensions: [
      basicSetup,
      yCollab(store.getYText()!, store.getAwareness(), { undoManager: store.getUndoManager() }),
    ],
  });

  viewRef.current = new EditorView({
      state: startState,
      parent: editorRef.current,
  });

  return () => viewRef.current?.destroy();
}, [store]);
```

</Tab>
<Tab title="Other Frameworks">

```js
// Create the CRDT store
const store = await createVeltCodeMirrorStore({
  editorId: editorId,
  veltClient: veltClient,
});

// Create editor state with yCollab extension
const startState = EditorState.create({
  doc: store.getYText()?.toString() ?? '',
  extensions: [
    basicSetup,
    yCollab(store.getYText(), store.getAwareness(), {
      undoManager: store.getUndoManager(),
    }),
  ],
});

// Create editor view
const view = new EditorView({
  state: startState,
  parent: editorContainer,
});
```

</Tab>
</Tabs>

## Notes

- **Unique editorId**: Use a unique `editorId` per editor instance.
- **Wait for auth**: Initialize the store only after the Velt client is ready.
- **Use yCollab**: Pass the store's Yjs text, awareness, and undo manager to `yCollab`.
- **Initialize and clean up**: Destroy the `EditorView` and store on unmount to avoid leaks.

## Testing and Debugging

**To test collaboration:**
1. Login two unique users on two browser profiles and open the same page in both.
2. Edit in one window and verify changes and cursors appear in the other.

**Common issues:**
- Cursors not appearing: Ensure each editor has a unique `editorId` and users are authenticated. Also ensure that you are logged in with two different users in two different browser profiles.
- Editor not loading: Confirm the Velt client is initialized and the API key is valid.
- Disconnected session: Check network.

<Tip>
Use the [VeltCrdtStoreMap debugging interface](/realtime-collaboration/crdt/setup/core#veltcrdtstoremap) to inspect and monitor your CRDT stores in real-time from the browser console.
</Tip>

## Complete Example

<Tabs>
<Tab title="React / Next.js">

[Open Live Demo In Larger Window](https://sample-apps-codemirror-crdt-demo.vercel.app/) | [View Demo Repo](https://github.com/velt-js/sample-apps/tree/main/apps/react/crdt/text-editors/codemirror/codemirror-crdt-demo)

```jsx Complete Implementation expandable lines
// Import required modules
import { useVeltCodeMirrorCrdtExtension } from "@veltdev/codemirror-crdt-react";
import { yCollab } from "y-codemirror.next";
import { EditorState } from "@codemirror/state";
import { basicSetup, EditorView } from "codemirror";

// Add hook in your codemirror editor component
const { store, isLoading } = useVeltCodeMirrorCrdtExtension({ editorId });

useEffect(() => {
    if (!store || !editorRef.current) return;

    // Clean up existing view if any
    viewRef.current?.destroy();

    const startState = EditorState.create({
        doc: store.getYText()?.toString() ?? '',
        extensions: [
            basicSetup,
            autocompletion(),
            yCollab(store.getYText()!, store.getAwareness(), { undoManager: store.getUndoManager() }),
        ],
    });

    viewRef.current = new EditorView({
        state: startState,
        parent: editorRef.current,
    });

    return () => {
        viewRef.current?.destroy();
        viewRef.current = null;
    };
}, [store]);
```

</Tab>
<Tab title="Other Frameworks">

[Open Live Demo In Larger Window](https://sample-apps-codemirror-non-react-cr.vercel.app/) | [View Demo Repo](https://github.com/velt-js/sample-apps/tree/main/apps/javascript/crdt/text-editors/codemirror/codemirror-crdt-demo)

```js Complete Implementation expandable lines
// Import required modules
import { initVelt } from '@veltdev/client';
import { createVeltCodeMirrorStore } from '@veltdev/codemirror-crdt';
import { yCollab } from 'y-codemirror.next';
import { EditorState } from '@codemirror/state';
import { basicSetup, EditorView } from 'codemirror';

// Step 1: Initialize Velt client
const veltClient = await initVelt('YOUR_API_KEY');

// Step 2: Authenticate user
await veltClient.identify({ userId: 'user-1', name: 'John Doe' });

// Step 3: Set document
await veltClient.setDocument('my-document-id');

// Step 4: Create CRDT store
const store = await createVeltCodeMirrorStore({
  editorId: 'velt-codemirror-crdt-demo',
  veltClient: veltClient,
});

// Step 5: Create CodeMirror editor
const startState = EditorState.create({
  doc: store.getYText()?.toString() ?? '',
  extensions: [
    basicSetup,
    yCollab(store.getYText(), store.getAwareness(), {
      undoManager: store.getUndoManager(),
    }),
  ],
});

const view = new EditorView({
  state: startState,
  parent: document.getElementById('editor'),
});

// Cleanup on unmount
view.destroy();
store.destroy();
```

</Tab>
<Tab title="React / Next.js Live Demo">

[Open Live Demo In Larger Window](https://sample-apps-codemirror-crdt-demo.vercel.app/) | [View Demo Repo](https://github.com/velt-js/sample-apps/tree/main/apps/react/crdt/text-editors/codemirror/codemirror-crdt-demo)

<Frame>
  <iframe
    src="https://sample-apps-codemirror-crdt-demo.vercel.app/"
    className="w-full"
    height="500px"
  ></iframe>
</Frame>

</Tab>
<Tab title="Non-React Demo">

[Open Live Demo In Larger Window](https://sample-apps-codemirror-non-react-cr.vercel.app/) | [View Demo Repo](https://github.com/velt-js/sample-apps/tree/main/apps/javascript/crdt/text-editors/codemirror/codemirror-crdt-demo)

<Frame>
  <iframe
    src="https://sample-apps-codemirror-non-react-cr.vercel.app/"
    className="w-full"
    height="500px"
  ></iframe>
</Frame>

</Tab>
</Tabs>

## APIs

### Custom Encryption

You can encrypt CRDT data before it’s stored in Velt by registering a custom encryption provider. For CRDT methods, input data is of type `Uint8Array | number[]`.

<Tabs>
<Tab title="React / Next.js">

```ts
async function encryptData(config: EncryptConfig<number[]>): Promise<string> {
  const encryptedData = await yourEncryptDataMethod(config.data);
  return encryptedData;
}

async function decryptData(config: DecryptConfig<string>): Promise<number[]> {
  const decryptedData = await yourDecryptDataMethod(config.data);
  return decryptedData;
}

const encryptionProvider: VeltEncryptionProvider<number[], string> = {
  encrypt: encryptData,
  decrypt: decryptData,
};

<VeltProvider
  apiKey="YOUR_API_KEY"
  encryptionProvider={encryptionProvider}
/>

```

</Tab>
<Tab title="Other Frameworks">

```ts
async function encryptData(config: EncryptConfig<number[]>): Promise<string> {
  const encryptedData = await yourEncryptDataMethod(config.data);
  return encryptedData;
}

async function decryptData(config: DecryptConfig<string>): Promise<number[]> {
  const decryptedData = await yourDecryptDataMethod(config.data);
  return decryptedData;
}

const encryptionProvider: VeltEncryptionProvider<number[], string> = {
  encrypt: encryptData,
  decrypt: decryptData,
};

client.setEncryptionProvider(encryptionProvider);
```

</Tab>
</Tabs>

See also: [setEncryptionProvider()](/api-reference/sdk/api/api-methods#setencryptionprovider-encryptionprovider)
 · [VeltEncryptionProvider](/api-reference/sdk/models/data-models#veltencryptionprovider)
 · [EncryptConfig](/api-reference/sdk/models/data-models#encryptconfig)
 · [DecryptConfig](/api-reference/sdk/models/data-models#decryptconfig)

### Initialization

<Tabs>
<Tab title="React / Next.js">

#### [useVeltCodeMirrorCrdtExtension()](/api-reference/sdk/api/api-methods#useveltcodemirrorcrdtextension)

React hook that provides real-time collaborative editing on CodeMirror editor with Yjs and Velt SDK.

- Signature: `useVeltCodeMirrorCrdtExtension(config: VeltCodeMirrorCrdtExtensionConfig)`
- Params: [VeltCodeMirrorCrdtExtensionConfig](/api-reference/sdk/models/data-models#veltcodemirrorcrdtextensionconfig)
  - `editorId`: Unique identifier for the editor instance.
  - `initialContent`: Initial content for the editor.
  - `debounceMs`: Debounce time for update propagation (ms).
- Returns: [VeltCodeMirrorCrdtExtensionResponse](/api-reference/sdk/models/data-models#veltcodemirrorcrdtextensionresponse)
  - `store`: CodeMirror CRDT store instance.
  - `isLoading`: Whether the store is initialized. `false` once store is initialized, `true` by default.

```jsx
const { store, isLoading } = useVeltCodeMirrorCrdtExtension({ 
  editorId: 'velt-codemirror-crdt-demo' 
});
```

</Tab>
<Tab title="Other Frameworks">

#### [createVeltCodeMirrorStore()](/api-reference/sdk/api/api-methods#createveltcodemirrorstore)

Factory function that creates and initializes a `VeltCodeMirrorStore` instance for collaborative editing.

- Signature: `createVeltCodeMirrorStore(config: VeltCodeMirrorStoreConfig): Promise<VeltCodeMirrorStore | null>`
- Params: `VeltCodeMirrorStoreConfig`
  - `editorId`: Unique identifier for the editor instance.
  - `veltClient`: Velt client instance (from `initVelt()`).
  - `initialContent`: Optional initial content for the editor.
  - `debounceMs`: Optional debounce time for update propagation (ms).
- Returns: `Promise<VeltCodeMirrorStore | null>` - The store instance or null if creation fails.

```js
import { createVeltCodeMirrorStore } from '@veltdev/codemirror-crdt';

const store = await createVeltCodeMirrorStore({
  editorId: 'velt-codemirror-crdt-demo',
  veltClient: client,
  initialContent: '// Start coding...',
});
```

</Tab>
</Tabs>


{/*
#### [createVeltCodeMirrorStore](/api-reference/sdk/api/api-methods#createveltcodemirrorstore)

Create and initialize a collaborative CodeMirror store instance.

- Params: [VeltCodeMirrorStoreConfig](/api-reference/sdk/models/data-models#veltcodemirrorstoreconfig)
- Returns: `Promise<VeltCodeMirrorStore | null>`

<Tabs>
<Tab title="React / Next.js">

```jsx
const store = await createVeltCodeMirrorStore({ editorId: 'velt-cm-doc', veltClient: client });
```

</Tab>
<Tab title="Other Frameworks">

```js
const store = await createVeltCodeMirrorStore({ editorId: 'velt-cm-doc', veltClient: client });
```

</Tab>
</Tabs>
*/}

### Store Methods

#### [store.getStore()](/api-reference/sdk/api/api-methods#getstore)

Get the underlying `Store<string>` that manages document state and synchronization.

- Returns: `Store<string>`

```ts
const underlying = store.getStore();
```

#### [store.getYDoc()](/api-reference/sdk/api/api-methods#getydoc)

Access the Yjs document used for collaborative editing.

- Returns: `Y.Doc`

```ts
const ydoc = store.getYDoc();
```

#### [store.getYText()](/api-reference/sdk/api/api-methods#getytext)

Get the shared Y.Text bound to the current CodeMirror document.

- Returns: `Y.Text | null`

```ts
const docText = store.getYText()?.toString() ?? '';
```

#### [store.getAwareness()](/api-reference/sdk/api/api-methods#getawareness)

Access the Yjs Awareness instance associated with the store.

- Returns: `Awareness`

```ts
yCollab(store.getYText()!, store.getAwareness(), { undoManager: store.getUndoManager() });
```

#### [store.getUndoManager()](/api-reference/sdk/api/api-methods#getundomanager)

Access the Yjs UndoManager for collaborative undo/redo.

- Returns: `Y.UndoManager`

```ts
const extensions = [
  basicSetup,
  yCollab(store.getYText()!, store.getAwareness(), { undoManager: store.getUndoManager() }),
];
```

#### [store.destroy()](/api-reference/sdk/api/api-methods#destroy)

Cleans up all resources, listeners, and destroys the store instance. Call this when unmounting the editor to prevent memory leaks.

- Returns: `void`

```ts
// Cleanup when done
store.destroy();
```