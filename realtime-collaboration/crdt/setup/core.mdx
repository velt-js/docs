---
title: Core
description: Setup Multiplayer Editing for any frameworks or custom implementations.
---

## Introduction

Use these guides to add Yjs-based CRDT to your project with Velt. Pick the React Hook wrapper for the fastest integration in React apps, or the core library for other frameworks and custom implementations.

## Setup

### Step 1: Install Dependencies

<Tabs>
<Tab title="React / Next.js">

**npm:**
```bash
npm install @veltdev/crdt-react @veltdev/crdt @veltdev/react
```

**yarn:**
```bash
yarn add @veltdev/crdt-react @veltdev/crdt @veltdev/react
```

</Tab>
<Tab title="Other Frameworks">

**npm:**
```bash
npm install @veltdev/crdt @veltdev/client
```

**yarn:**
```bash
yarn add @veltdev/crdt @veltdev/client
```

</Tab>
</Tabs>

### Step 2: Initialize Velt in your app

Initialize the Velt client by following the [Velt Setup Docs](/get-started/quickstart). This is required for the collaboration engine to work.


### Step 3: Initialize a CRDT store

<Tabs>
<Tab title="React / Next.js">

```jsx
import { useVeltCrdtStore } from '@veltdev/crdt-react';

function Component() {
  const { store } = useVeltCrdtStore<string>({
    id: 'my-collab-note',
    type: 'text',
    initialValue: 'Hello, world!',
  });
  return null;
}
```

</Tab>
<Tab title="Other Frameworks">

```ts
import { createVeltStore } from '@veltdev/crdt';
import { initVelt } from '@veltdev/client';

const veltClient = await initVelt('YOUR_API_KEY');

const store = await createVeltStore<string>({
  id: 'my-document',
  type: 'text', // 'array' | 'map' | 'text' | 'xml'
  initialValue: 'Hello, world!',
  veltClient,
});
```

</Tab>
</Tabs>

### Step 4: Set or update the store value

Set or update local changes to the store.

<Tabs>
<Tab title="React / Next.js">

```jsx
import { useVeltCrdtStore } from '@veltdev/crdt-react';

function Component() {
  const { update } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });
  const onChange = (e) => update(e.target.value);
  return <input onChange={onChange} />;
}
```

</Tab>
<Tab title="Other Frameworks">

```ts
store.update('Hello, collaborative world!');
```

</Tab>
</Tabs>

### Step 5: Listen for changes

Listen and subscribe for updates from local and remote peers.

<Tabs>
<Tab title="React / Next.js">

```jsx
import { useEffect } from 'react';
import { useVeltCrdtStore } from '@veltdev/crdt-react';

function Component() {
  const { value } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });

  useEffect(() => {
    console.log('Updated value:', value);
  }, [value]);

  return null;
}
```

</Tab>
<Tab title="Other Frameworks">

```ts
const unsubscribe = store.subscribe((newValue) => {
  console.log('Updated value:', newValue);
});
```

</Tab>
</Tabs>


### Step 6: Save and restore versions

Create checkpoints and roll back when needed.

<Tabs>
<Tab title="React / Next.js">

```jsx
import { useVeltCrdtStore } from '@veltdev/crdt-react';

function Component() {
  const { saveVersion, getVersions, getVersionById, setStateFromVersion } =
    useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });

  async function onSave() {
    const versionId = await saveVersion('Checkpoint');
    console.log('Saved version:', versionId);
  }

  async function onRestoreLatest() {
    const versions = await getVersions();
    if (versions.length === 0) return;
    const latest = versions[0];
    await setStateFromVersion(latest);
  }

  return (
    <div>
      <button onClick={onSave}>Save Version</button>
      <button onClick={onRestoreLatest}>Restore Latest</button>
    </div>
  );
}
```

</Tab>
<Tab title="Other Frameworks">

```ts
const versionId = await store.saveVersion('Initial checkpoint');
const versions = await store.getVersions();
const fetched = await store.getVersionById(versionId);
if (fetched) {
  await store.setStateFromVersion(fetched);
}
```

</Tab>
</Tabs>

## APIs

### Custom Encryption

Encrypt CRDT data before it's stored in Velt by registering a custom encryption provider. For CRDT methods, input data is of type `Uint8Array | number[]`.

<Tabs>
<Tab title="React / Next.js">

```tsx
async function encryptData(config: EncryptConfig<number[]>): Promise<string> {
  const encryptedData = await yourEncryptDataMethod(config.data);
  return encryptedData;
}

async function decryptData(config: DecryptConfig<string>): Promise<number[]> {
  const decryptedData = await yourDecryptDataMethod(config.data);
  return decryptedData;
}

const encryptionProvider: VeltEncryptionProvider<number[], string> = {
  encrypt: encryptData,
  decrypt: decryptData,
};

<VeltProvider
  apiKey="YOUR_API_KEY"
  encryptionProvider={encryptionProvider}
/>

```

</Tab>
<Tab title="Other Frameworks">

```ts
async function encryptData(config: EncryptConfig<number[]>): Promise<string> {
  const encryptedData = await yourEncryptDataMethod(config.data);
  return encryptedData;
}

async function decryptData(config: DecryptConfig<string>): Promise<number[]> {
  const decryptedData = await yourDecryptDataMethod(config.data);
  return decryptedData;
}

const encryptionProvider: VeltEncryptionProvider<number[], string> = {
  encrypt: encryptData,
  decrypt: decryptData,
};

client.setEncryptionProvider(encryptionProvider);
```

</Tab>
</Tabs>

See also: [setEncryptionProvider()](/api-reference/sdk/api/api-methods#setencryptionprovider-encryptionprovider)
 · [VeltEncryptionProvider](/api-reference/sdk/models/data-models#veltencryptionprovider)
 · [EncryptConfig](/api-reference/sdk/models/data-models#encryptconfig)
 · [DecryptConfig](/api-reference/sdk/models/data-models#decryptconfig)


### Core

#### Initialization

<Tabs>
<Tab title="React / Next.js">

#### [useVeltCrdtStore](/api-reference/sdk/api/api-methods#useveltcrdtstore)

React hook to create and sync a collaborative CRDT store.

- Params: [useveltcrdtstore](/api-reference/sdk/models/data-models#useveltcrdtstore)
  - `id`: Unique identifier for the store.
  - `type`: Type of Yjs data structure (`'text'` | `'array'` | `'map'` | `'xml'`).
  - `initialValue`: Optional initial value for the store.
  - `debounceMs`: Optional debounce time for update propagation (ms).
  - `enablePresence`: Optional boolean to enable realtime presence tracking (default: `true`).
- Returns: Store properties and methods

```jsx
const {
  value,
  versions,
  store,
  update,
  saveVersion,
  getVersions,
  getVersionById,
  restoreVersion,
  setStateFromVersion,
} = useVeltCrdtStore<string>({
  id: 'my-collab-note',
  type: 'text',
  initialValue: 'Hello, world!',
  debounceMs: 100,
  enablePresence: true,
});
```

</Tab>
<Tab title="Other Frameworks">

#### [createVeltStore](/api-reference/sdk/api/api-methods#createveltstore)

Create and initialize a collaborative CRDT store.

- Params: [StoreConfig](/api-reference/sdk/models/data-models#storeconfig<t>%3B)
  - `id`: Unique identifier for the store.
  - `type`: Type of Yjs data structure (`'text'` | `'array'` | `'map'` | `'xml'`).
  - `initialValue`: Optional initial value for the store.
  - `veltClient`: Velt client instance (from `initVelt()`).
  - `debounceMs`: Optional debounce time for update propagation (ms).
  - `enablePresence`: Optional boolean to enable realtime presence tracking (default: `true`).
- Returns: `Promise<Store<T> | null>`

```ts
const store = await createVeltStore<string>({
  id: 'my-document',
  type: 'text',
  initialValue: 'Hello, world!',
  veltClient,
  debounceMs: 100,
  enablePresence: true,
});
```

</Tab>
</Tabs>

#### [update](/api-reference/sdk/api/api-methods#update)

Update the store value and sync to peers.

- Params: `newValue: T`
- Returns: `void`

<CodeGroup>
```jsx React
const { update } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });
update('New value');
```

```ts Other Frameworks
store.update('New Value');
```
</CodeGroup>

#### [getValue](/api-reference/sdk/api/api-methods#getvalue)

Access the current store value.

##### **Get one-time current value**

<Tabs>
<Tab title="React / Next.js">

**[value](/api-reference/sdk/api/api-methods#value)**

Reactive property that updates automatically when the store changes.

- Type: `T | null`

```jsx
const { value } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });
console.log(value);
```

</Tab>
<Tab title="Other Frameworks">

**[getValue()](/api-reference/sdk/api/api-methods#getvalue)**

Method to retrieve the current store value.

- Returns: `T`

```ts
const value = store.getValue();
console.log(value);
```

</Tab>
</Tabs>

##### **Subscribe to value changes**

Listen for updates from local and remote peers.

<Tabs>
<Tab title="React / Next.js">

Use `useEffect` with the reactive `value` property for automatic updates, or use `store.subscribe()` for manual subscriptions.

```jsx
const { store, value } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });

// Option 1: Use reactive value (recommended)
useEffect(() => {
  console.log('Value changed:', value);
}, [value]);

// Option 2: Manual subscription
useEffect(() => {
  if (!store) return;
  const unsubscribe = store.subscribe((newValue) => {
    console.log('Updated value:', newValue);
  });
  return unsubscribe;
}, [store]);
```

</Tab>
<Tab title="Other Frameworks">

**[subscribe()](/api-reference/sdk/api/api-methods#subscribe)**

Subscribe to changes in the store.

- Params: `(newValue: T) => void`
- Returns: `() => void` (unsubscribe function)

```ts
const unsubscribe = store.subscribe((newValue) => {
  console.log('Updated value:', newValue);
});

// Later, to stop listening:
unsubscribe();
```

</Tab>
</Tabs>

#### [store](/api-reference/sdk/api/api-methods#store)

Access the underlying Velt Store instance for advanced operations.

<Tabs>
<Tab title="React / Next.js">

The underlying store instance returned by the hook.

- Type: `Store<T> | null`

```jsx
const { store } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });
console.log(store);
```

</Tab>
<Tab title="Other Frameworks">

The store instance is returned directly from `createVeltStore()`.

- Type: `Store<T> | null`

```ts
const store = await createVeltStore<string>({
  id: 'my-document',
  type: 'text',
  veltClient,
});
console.log(store);
```

</Tab>
</Tabs>

#### [destroy](/api-reference/sdk/api/api-methods#destroy)

Clean up resources when done with the store.

<Tabs>
<Tab title="React / Next.js">

Cleanup is handled automatically by the hook when the component unmounts. No manual cleanup is required.

```jsx
// Cleanup happens automatically when component unmounts
const { store } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });
```

</Tab>
<Tab title="Other Frameworks">

Manually destroy the store to clean up resources and listeners.

- Returns: `void`

```ts
// When done with the store
store.destroy();
```

</Tab>
</Tabs>

### Versions

#### [saveVersion](/api-reference/sdk/api/api-methods#saveversion)

Save a snapshot of the current state as a named version.

- Params: `versionName: string`
- Returns: `Promise<string>`

<Tabs>
<Tab title="React / Next.js">

```jsx
const { saveVersion } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });
await saveVersion('Checkpoint');
```

</Tab>
<Tab title="Other Frameworks">

```ts
const versionId = await store.saveVersion('Initial checkpoint');
```

</Tab>
</Tabs>

#### [getVersions](/api-reference/sdk/api/api-methods#getversions)

Fetch all saved versions.

- Returns: `Promise<Version[]>`

<Tabs>
<Tab title="React / Next.js">

**Reactive property:**

```jsx
const { versions } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });
console.log(versions);
```

**Async method:**

```jsx
const { getVersions } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });
const versions = await getVersions();
```

</Tab>
<Tab title="Other Frameworks">

```ts
const versions = await store.getVersions();
```

</Tab>
</Tabs>

#### [getVersionById](/api-reference/sdk/api/api-methods#getversionbyid)

Fetch a specific version by ID.

- Params: `versionId: string`
- Returns: `Promise<Version | null>`

<Tabs>
<Tab title="React / Next.js">

```jsx
const { getVersionById } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });
const version = await getVersionById('abc123');
```

</Tab>
<Tab title="Other Frameworks">

```ts
const version = await store.getVersionById('abc123');
```

</Tab>
</Tabs>

#### [setStateFromVersion](/api-reference/sdk/api/api-methods#setstatefromversion)

Restore the store state from a specific version object.

- Params: `version: Version`
- Returns: `Promise<void>`

<Tabs>
<Tab title="React / Next.js">

```jsx
const { setStateFromVersion } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });
await setStateFromVersion(version);
```

</Tab>
<Tab title="Other Frameworks">

```ts
await store.setStateFromVersion(version);
```

</Tab>
</Tabs>

#### [restoreVersion](/api-reference/sdk/api/api-methods#restoreversion)

Restore the store to a specific version using its ID.

<Tabs>
<Tab title="React / Next.js">

Convenience method that fetches and restores a version in one call.

- Params: `versionId: string`
- Returns: `Promise<boolean>`

```jsx
const { restoreVersion } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });
await restoreVersion('abc123');
```

</Tab>
<Tab title="Other Frameworks">

Combine `getVersionById()` and `setStateFromVersion()` to achieve the same result.

```ts
const version = await store.getVersionById('abc123');
if (version) {
  await store.setStateFromVersion(version);
}
```

</Tab>
</Tabs>

### Yjs

#### [getDoc](/api-reference/sdk/api/api-methods#getdoc)

Get the underlying Yjs document.

- Returns: `Y.Doc`

```ts
const ydoc = store.getDoc();
```

#### [getProvider](/api-reference/sdk/api/api-methods#getprovider)

Get the provider instance for the store.

- Returns: `Provider`

```ts
const provider = store.getProvider();
```

#### [getText](/api-reference/sdk/api/api-methods#gettext)

Get the Y.Text instance if store type is 'text'.

- Returns: `Y.Text | null`

```ts
const ytext = store.getText();
```

#### [getXml](/api-reference/sdk/api/api-methods#getxml)

Get the Y.XmlFragment instance if store type is 'xml'.

- Returns: `Y.XmlFragment | null`

```ts
const yxml = store.getXml();
```

### Debugging

Use the Velt Chrome Extension or the `window.VeltCrdtStoreMap` debugging interface to inspect and monitor your CRDT stores.

#### window.VeltCrdtStoreMap

`window.VeltCrdtStoreMap` is a global debugging interface that exposes all active CRDT stores in your application. It's automatically created and maintained by the Velt CRDT library, allowing you to inspect, monitor, and debug CRDT stores from the browser console or developer tools.

#### [get()](/api-reference/sdk/api/api-methods#get)

Get a store by its ID.

- Params:
  - `id` (optional): Store ID. If omitted, returns the first registered store.
- Returns: `VeltCrdtStore | undefined` - Store instance or undefined if not found
  - **Store object methods:**
    - `getValue()`: Get the current value from the store
    - `subscribe(callback: (value: any) => void)`: Subscribe to changes in the store. Returns an unsubscribe function.

<Tabs>
<Tab title="Basic Usage">

```jsx
// Get a specific store
const store = window.VeltCrdtStoreMap.get('my-store-id');
if (store) {
  console.log('Current value:', store.getValue());
}

// Get the first registered store
const firstStore = window.VeltCrdtStoreMap.get();
```

</Tab>
<Tab title="Inspect Store">

```jsx
// Get store and inspect
const store = window.VeltCrdtStoreMap.get('editor-123');

if (store) {
  // Get current value
  console.log('Current value:', store.getValue());

  // Subscribe to changes
  store.subscribe((value) => {
    console.log('Value updated:', value);
  });

  // Log value every second
  setInterval(() => {
    console.log('Current value:', store.getValue());
  }, 1000);
}
```

</Tab>
</Tabs>

#### [getAll()](/api-reference/sdk/api/api-methods#getall)

Get all registered stores as an object.

- Returns: `{ [id: string]: VeltCrdtStore }` - Object mapping store IDs to store instances
  - **Each store object provides:**
    - `getValue()`: Get the current value from the store
    - `subscribe(callback: (value: any) => void)`: Subscribe to changes in the store. Returns an unsubscribe function.

<Tabs>
<Tab title="Basic Usage">

```jsx
// Get all stores
const allStores = window.VeltCrdtStoreMap.getAll();
console.log('Total stores:', Object.keys(allStores).length);

// Iterate through all stores
Object.entries(allStores).forEach(([id, store]) => {
  console.log(`Store ${id}:`, store.getValue());
});
```

</Tab>
<Tab title="Find Stores">

```jsx
// Find all stores
const allStores = window.VeltCrdtStoreMap.getAll();

// Find stores by pattern
const editorStores = Object.keys(allStores).filter(id =>
  id.startsWith('editor-')
);
console.log('Editor stores:', editorStores);

// Get specific subset
const documentStores = Object.keys(allStores).filter(id =>
  id.includes('document')
);
```

</Tab>
<Tab title="Monitor All Stores">

```jsx
// Monitor all stores for changes
Object.keys(window.VeltCrdtStoreMap.stores).forEach(storeId => {
  const store = window.VeltCrdtStoreMap.get(storeId);

  store.subscribe((value) => {
    console.log(`Store "${storeId}" changed:`, value);
  });
});
```

</Tab>
</Tabs>

#### Events

The library dispatches custom events when stores are registered or unregistered.

##### **veltCrdtStoreRegister**

Fired when a new store is registered.

- Event Detail: `{ id: string }` - Store ID

```jsx
window.addEventListener('veltCrdtStoreRegister', (event) => {
  console.log('Store registered:', event.detail.id);
  const store = window.VeltCrdtStoreMap.get(event.detail.id);
  // Do something with the new store
});
```

##### **veltCrdtStoreUnregister**

Fired when a store is unregistered (destroyed).

- Event Detail: `{ id: string }` - Store ID

```jsx
window.addEventListener('veltCrdtStoreUnregister', (event) => {
  console.log('Store unregistered:', event.detail.id);
});
```