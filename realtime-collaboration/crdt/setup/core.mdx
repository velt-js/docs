---
title: Core
description: Setup Multiplayer Editing for any frameworks or custom implementations.
---

## Introduction

Use these guides to add Yjs-based CRDT to your project with Velt. Pick the React Hook wrapper for the fastest integration in React apps, or the core library for other frameworks and custom implementations.

## Setup

### Step 1: Install Dependencies

<Tabs>
<Tab title="React / Next.js">

**npm:**
```bash
npm install @veltdev/crdt-react @veltdev/crdt @veltdev/react
```

**yarn:**
```bash
yarn add @veltdev/crdt-react @veltdev/crdt @veltdev/react
```

</Tab>
<Tab title="Other Frameworks">

**npm:**
```bash
npm install @veltdev/crdt @veltdev/client
```

**yarn:**
```bash
yarn add @veltdev/crdt @veltdev/client
```

</Tab>
</Tabs>

### Step 2: Initialize Velt in your app

Initialize the Velt client by following the [Velt Setup Docs](/get-started/quickstart). This is required for the collaboration engine to work.


### Step 3: Initialize a CRDT store

<Tabs>
<Tab title="React / Next.js">

```jsx
import { useVeltCrdtStore } from '@veltdev/crdt-react';

function Component() {
  const { store } = useVeltCrdtStore<string>({
    id: 'my-collab-note',
    type: 'text',
    initialValue: 'Hello, world!',
  });
  return null;
}
```

</Tab>
<Tab title="Other Frameworks">

```ts
import { createVeltStore } from '@veltdev/crdt';
import { initVelt } from '@veltdev/client';

const veltClient = await initVelt('YOUR_API_KEY');

const store = await createVeltStore<string>({
  id: 'my-document',
  type: 'text', // 'array' | 'map' | 'text' | 'xml'
  initialValue: 'Hello, world!',
  veltClient,
});
```

</Tab>
</Tabs>

### Step 4: Set or update the store value

Set or update local changes to the store.

<Tabs>
<Tab title="React / Next.js">

```jsx
import { useVeltCrdtStore } from '@veltdev/crdt-react';

function Component() {
  const { update } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });
  const onChange = (e) => update(e.target.value);
  return <input onChange={onChange} />;
}
```

</Tab>
<Tab title="Other Frameworks">

```ts
store.update('Hello, collaborative world!');
```

</Tab>
</Tabs>

### Step 5: Listen for changes

Listen and subscribe for updates from local and remote peers.

<Tabs>
<Tab title="React / Next.js">

```jsx
import { useEffect } from 'react';
import { useVeltCrdtStore } from '@veltdev/crdt-react';

function Component() {
  const { store } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });

  useEffect(() => {
    if (!store) return;
    const unsubscribe = store.subscribe((newValue) => {
      console.log('Updated value:', newValue);
    });
    return unsubscribe;
  }, [store]);

  return null;
}
```

</Tab>
<Tab title="Other Frameworks">

```ts
const unsubscribe = store.subscribe((newValue) => {
  console.log('Updated value:', newValue);
});
```

</Tab>
</Tabs>


### Step 6: Save and restore versions

Create checkpoints and roll back when needed.

<Tabs>
<Tab title="React / Next.js">

```jsx
import { useVeltCrdtStore } from '@veltdev/crdt-react';

function Component() {
  const { saveVersion, getVersions, getVersionById, setStateFromVersion } =
    useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });

  async function onSave() {
    const versionId = await saveVersion('Checkpoint');
    console.log('Saved version:', versionId);
  }

  async function onRestoreLatest() {
    const versions = await getVersions();
    if (versions.length === 0) return;
    const latest = versions[0];
    await setStateFromVersion(latest);
  }

  return (
    <div>
      <button onClick={onSave}>Save Version</button>
      <button onClick={onRestoreLatest}>Restore Latest</button>
    </div>
  );
}
```

</Tab>
<Tab title="Other Frameworks">

```ts
const versionId = await store.saveVersion('Initial checkpoint');
const versions = await store.getVersions();
const fetched = await store.getVersionById(versionId);
if (fetched) {
  await store.setStateFromVersion(fetched);
}
```

</Tab>
</Tabs>

## APIs

### Custom Encryption

Encrypt CRDT data before it’s stored in Velt by registering a custom encryption provider. For CRDT methods, input data is of type `Uint8Array | number[]`.

<Tabs>
<Tab title="React / Next.js">

```tsx
async function encryptData(config: EncryptConfig<number[]>): Promise<string> {
  const encryptedData = await yourEncryptDataMethod(config.data);
  return encryptedData;
}

async function decryptData(config: DecryptConfig<string>): Promise<number[]> {
  const decryptedData = await yourDecryptDataMethod(config.data);
  return decryptedData;
}

const encryptionProvider: VeltEncryptionProvider<number[], string> = {
  encrypt: encryptData,
  decrypt: decryptData,
};

<VeltProvider
  apiKey="YOUR_API_KEY"
  encryptionProvider={encryptionProvider}
/>

```

</Tab>
<Tab title="Other Frameworks">

```ts
async function encryptData(config: EncryptConfig<number[]>): Promise<string> {
  const encryptedData = await yourEncryptDataMethod(config.data);
  return encryptedData;
}

async function decryptData(config: DecryptConfig<string>): Promise<number[]> {
  const decryptedData = await yourDecryptDataMethod(config.data);
  return decryptedData;
}

const encryptionProvider: VeltEncryptionProvider<number[], string> = {
  encrypt: encryptData,
  decrypt: decryptData,
};

client.setEncryptionProvider(encryptionProvider);
```

</Tab>
</Tabs>

See also: [setEncryptionProvider()](/api-reference/sdk/api/api-methods#setencryptionprovider-encryptionprovider)
 · [VeltEncryptionProvider](/api-reference/sdk/models/data-models#veltencryptionprovider)
 · [EncryptConfig](/api-reference/sdk/models/data-models#encryptconfig)
 · [DecryptConfig](/api-reference/sdk/models/data-models#decryptconfig)


### Initialization

<Tabs>
<Tab title="React / Next.js">

#### [useVeltCrdtStore](/api-reference/sdk/api/api-methods#useveltcrdtstore)

React hook to create and sync a collaborative CRDT store.

- Params: [useveltcrdtstore](/api-reference/sdk/models/data-models#useveltcrdtstore)
  - `id`: Unique identifier for the store.
  - `type`: Type of Yjs data structure (`'text'` | `'array'` | `'map'` | `'xml'`).
  - `initialValue`: Optional initial value for the store.
  - `debounceMs`: Optional debounce time for update propagation (ms).
  - `enablePresence`: Optional boolean to enable realtime presence tracking (default: `true`).
- Returns: Store properties and methods

```jsx
const {
  value,
  versions,
  store,
  update,
  saveVersion,
  getVersions,
  getVersionById,
  restoreVersion,
  setStateFromVersion,
} = useVeltCrdtStore<string>({
  id: 'my-collab-note',
  type: 'text',
  initialValue: 'Hello, world!',
  debounceMs: 100,
  enablePresence: true,
});
```

</Tab>
<Tab title="Other Frameworks">

#### [createVeltStore](/api-reference/sdk/api/api-methods#createveltstore)

Create and initialize a collaborative CRDT store.

- Params: [StoreConfig](/api-reference/sdk/models/data-models#storeconfig<t>%3B)
  - `id`: Unique identifier for the store.
  - `type`: Type of Yjs data structure (`'text'` | `'array'` | `'map'` | `'xml'`).
  - `initialValue`: Optional initial value for the store.
  - `veltClient`: Velt client instance (from `initVelt()`).
  - `debounceMs`: Optional debounce time for update propagation (ms).
  - `enablePresence`: Optional boolean to enable realtime presence tracking (default: `true`).
- Returns: `Promise<Store<T> | null>`

```ts
const store = await createVeltStore<string>({
  id: 'my-document',
  type: 'text',
  initialValue: 'Hello, world!',
  veltClient,
  debounceMs: 100,
  enablePresence: true,
});
```

</Tab>
</Tabs>

### Common Methods

These methods are available in both React and non-React frameworks.

#### [update](/api-reference/sdk/api/api-methods#update)

Update the store value and sync to peers.

- Params: `newValue: T`
- Returns: `void`

<CodeGroup>
```jsx React
update('New value');
```

```ts Other Frameworks
store.update('New Value');
```
</CodeGroup>

#### [saveVersion](/api-reference/sdk/api/api-methods#saveversion)

Save a snapshot of the current state as a named version.

- Params: `versionName: string`
- Returns: `Promise<string>`

<CodeGroup>
```jsx React
await saveVersion('Checkpoint');
```

```ts Other Frameworks
const versionId = await store.saveVersion('Initial checkpoint');
```
</CodeGroup>

#### [getVersions](/api-reference/sdk/api/api-methods#getversions)

Fetch all saved versions.

- Returns: `Promise<Version[]>`

<CodeGroup>
```jsx React
const versions = await getVersions();
```

```ts Other Frameworks
const versions = await store.getVersions();
```
</CodeGroup>

#### [getVersionById](/api-reference/sdk/api/api-methods#getversionbyid)

Fetch a specific version by ID.

- Params: `versionId: string`
- Returns: `Promise<Version | null>`

<CodeGroup>
```jsx React
const version = await getVersionById('abc123');
```

```ts Other Frameworks
const version = await store.getVersionById('abc123');
```
</CodeGroup>

#### [setStateFromVersion](/api-reference/sdk/api/api-methods#setstatefromversion)

Restore the store state from a specific version object.

- Params: `version: Version`
- Returns: `Promise<void>`

<CodeGroup>
```jsx React
await setStateFromVersion(version);
```

```ts Other Frameworks
await store.setStateFromVersion(version);
```
</CodeGroup>

### Framework-Specific Methods

#### Get Current Value

Access the current store value.

<Tabs>
<Tab title="React / Next.js">

**[value](/api-reference/sdk/api/api-methods#value)**

Reactive property that updates automatically when the store changes.

- Type: `T | null`

```jsx
const { value } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });
console.log(value);
```

</Tab>
<Tab title="Other Frameworks">

**[getValue()](/api-reference/sdk/api/api-methods#getvalue)**

Method to retrieve the current store value.

- Returns: `T`

```ts
const value = store.getValue();
console.log(value);
```

</Tab>
</Tabs>

#### Get All Versions

Access the list of all saved versions.

<Tabs>
<Tab title="React / Next.js">

**[versions](/api-reference/sdk/api/api-methods#versions)**

Reactive property that updates automatically when versions change.

- Type: `Version[]`

```jsx
const { versions } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });
console.log(versions);
```

</Tab>
<Tab title="Other Frameworks">

**[getVersions()](/api-reference/sdk/api/api-methods#getversions)**

Async method to fetch all saved versions.

- Returns: `Promise<Version[]>`

```ts
const versions = await store.getVersions();
console.log(versions);
```

</Tab>
</Tabs>

#### Access Store Instance

Access the underlying Velt Store instance for advanced operations.

<Tabs>
<Tab title="React / Next.js">

**[store](/api-reference/sdk/api/api-methods#store)**

The underlying store instance returned by the hook.

- Type: `Store<T> | null`

```jsx
const { store } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });
console.log(store);
```

</Tab>
<Tab title="Other Frameworks">

The store instance is returned directly from `createVeltStore()`.

- Type: `Store<T> | null`

```ts
const store = await createVeltStore<string>({
  id: 'my-document',
  type: 'text',
  veltClient,
});
console.log(store);
```

</Tab>
</Tabs>

#### Restore Version by ID

Restore the store to a specific version using its ID.

<Tabs>
<Tab title="React / Next.js">

**[restoreVersion()](/api-reference/sdk/api/api-methods#restoreversion)**

Convenience method that fetches and restores a version in one call.

- Params: `versionId: string`
- Returns: `Promise<boolean>`

```jsx
const { restoreVersion } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });
await restoreVersion('abc123');
```

</Tab>
<Tab title="Other Frameworks">

Combine `getVersionById()` and `setStateFromVersion()` to achieve the same result.

```ts
const version = await store.getVersionById('abc123');
if (version) {
  await store.setStateFromVersion(version);
}
```

</Tab>
</Tabs>

#### Subscribe to Changes

Listen for updates from local and remote peers.

<Tabs>
<Tab title="React / Next.js">

Use `useEffect` with `store.subscribe()` for manual subscriptions, or rely on the reactive `value` property for automatic updates.

```jsx
const { store, value } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });

// Option 1: Use reactive value (recommended)
useEffect(() => {
  console.log('Value changed:', value);
}, [value]);

// Option 2: Manual subscription
useEffect(() => {
  if (!store) return;
  const unsubscribe = store.subscribe((newValue) => {
    console.log('Updated value:', newValue);
  });
  return unsubscribe;
}, [store]);
```

</Tab>
<Tab title="Other Frameworks">

**[subscribe()](/api-reference/sdk/api/api-methods#subscribe)**

Subscribe to changes in the store.

- Params: `(newValue: T) => void`
- Returns: `() => void` (unsubscribe function)

```ts
const unsubscribe = store.subscribe((newValue) => {
  console.log('Updated value:', newValue);
});

// Later, to stop listening:
unsubscribe();
```

</Tab>
</Tabs>

#### Cleanup / Destroy

Clean up resources when done with the store.

<Tabs>
<Tab title="React / Next.js">

Cleanup is handled automatically by the hook when the component unmounts. No manual cleanup is required.

```jsx
// Cleanup happens automatically when component unmounts
const { store } = useVeltCrdtStore<string>({ id: 'my-collab-note', type: 'text' });
```

</Tab>
<Tab title="Other Frameworks">

**[destroy()](/api-reference/sdk/api/api-methods#destroy)**

Manually destroy the store to clean up resources and listeners.

- Returns: `void`

```ts
// When done with the store
store.destroy();
```

</Tab>
</Tabs>

### Yjs Integration Methods

#### [getDoc](/api-reference/sdk/api/api-methods#getdoc)

Get the underlying Yjs document.

- Returns: `Y.Doc`

```ts
const ydoc = store.getDoc();
```

#### [getProvider](/api-reference/sdk/api/api-methods#getprovider)

Get the provider instance for the store.

- Returns: `Provider`

```ts
const provider = store.getProvider();
```

#### [getText](/api-reference/sdk/api/api-methods#gettext)

Get the Y.Text instance if store type is 'text'.

- Returns: `Y.Text | null`

```ts
const ytext = store.getText();
```

#### [getXml](/api-reference/sdk/api/api-methods#getxml)

Get the Y.XmlFragment instance if store type is 'xml'.

- Returns: `Y.XmlFragment | null`

```ts
const yxml = store.getXml();
```

## Developer Tools

### VeltCrdtStoreMap

`window.VeltCrdtStoreMap` is a global debugging interface that exposes all active CRDT stores in your application. It's automatically created and maintained by the Velt CRDT library, allowing you to inspect, monitor, and debug CRDT stores from the browser console or developer tools.

#### Availability

The `VeltCrdtStoreMap` interface is automatically available on the global `window` object when you initialize any CRDT store.

- Automatically available in browser environments
- Exposed on `window.VeltCrdtStoreMap` when any CRDT store is created
- Singleton instance (same object reference across all stores)
- Available immediately after store initialization

#### Purpose

Use VeltCrdtStoreMap for:

- **Debugging**: Inspect store values and state
- **Monitoring**: Subscribe to store changes
- **Development**: Test and verify CRDT behavior
- **Troubleshooting**: Diagnose synchronization issues

#### API Reference

##### Methods

**get(id?: string): VeltCrdtStore | undefined**

Get a store by its ID.

- Params:
  - `id` (optional): Store ID. If omitted, returns the first registered store.
- Returns: `VeltCrdtStore | undefined` - Store instance or undefined if not found

**`getAll(): { [id: string]: VeltCrdtStore }`**

Get all registered stores as an object.

- Returns: Object mapping store IDs to store instances

##### Properties

**`stores: { [id: string]: VeltCrdtStore }`**

Direct access to all stores (computed property, same as getAll()).

#### Store Interface

Each store in the map implements the VeltCrdtStore interface:

**getValue(): any**

Get the current value from the store.

- Returns: Current store value (type depends on store type: string, array, map, etc.)

**subscribe(callback: (value: any) => void): () => void**

Subscribe to changes in the store.

- Params:
  - `callback`: Function called whenever the store value changes. Receives the new value as parameter
- Returns: Unsubscribe function to stop listening to changes

#### Usage Examples

<Tabs>
<Tab title="React / Next.js">

**Basic Inspection**

```jsx
// Check if VeltCrdtStoreMap is available
if (window.VeltCrdtStoreMap) {
  // Get all store IDs
  const storeIds = Object.keys(window.VeltCrdtStoreMap.stores);
  console.log('Available stores:', storeIds);

  // Get a specific store
  const store = window.VeltCrdtStoreMap.get('my-store-id');
  if (store) {
    console.log('Current value:', store.getValue());
  }
}
```

**Monitor Store Changes**

```jsx
// Monitor all stores
Object.keys(window.VeltCrdtStoreMap.stores).forEach(storeId => {
  const store = window.VeltCrdtStoreMap.get(storeId);

  store.subscribe((value) => {
    console.log(`Store "${storeId}" changed:`, value);
  });
});
```

**Debugging Specific Store**

```jsx
// Get store and inspect
const store = window.VeltCrdtStoreMap.get('editor-123');

if (store) {
  // Get current value
  console.log('Current value:', store.getValue());

  // Subscribe to changes
  store.subscribe((value) => {
    console.log('Value updated:', value);
  });

  // Log value every second
  setInterval(() => {
    console.log('Current value:', store.getValue());
  }, 1000);
}
```

**Finding Stores**

```jsx
// Find all stores
const allStores = window.VeltCrdtStoreMap.getAll();
console.log('Total stores:', Object.keys(allStores).length);

// Find stores by pattern
const editorStores = Object.keys(allStores).filter(id =>
  id.startsWith('editor-')
);
console.log('Editor stores:', editorStores);
```

</Tab>
<Tab title="Other Frameworks">

**Basic Inspection**

```html
<script>
// Check if VeltCrdtStoreMap is available
if (window.VeltCrdtStoreMap) {
  // Get all store IDs
  const storeIds = Object.keys(window.VeltCrdtStoreMap.stores);
  console.log('Available stores:', storeIds);

  // Get a specific store
  const store = window.VeltCrdtStoreMap.get('my-store-id');
  if (store) {
    console.log('Current value:', store.getValue());
  }
}
</script>
```

**Monitor Store Changes**

```html
<script>
// Monitor all stores
Object.keys(window.VeltCrdtStoreMap.stores).forEach(storeId => {
  const store = window.VeltCrdtStoreMap.get(storeId);

  store.subscribe((value) => {
    console.log(`Store "${storeId}" changed:`, value);
  });
});
</script>
```

**Debugging Specific Store**

```html
<script>
// Get store and inspect
const store = window.VeltCrdtStoreMap.get('editor-123');

if (store) {
  // Get current value
  console.log('Current value:', store.getValue());

  // Subscribe to changes
  store.subscribe((value) => {
    console.log('Value updated:', value);
  });

  // Log value every second
  setInterval(() => {
    console.log('Current value:', store.getValue());
  }, 1000);
}
</script>
```

**Finding Stores**

```html
<script>
// Find all stores
const allStores = window.VeltCrdtStoreMap.getAll();
console.log('Total stores:', Object.keys(allStores).length);

// Find stores by pattern
const editorStores = Object.keys(allStores).filter(id =>
  id.startsWith('editor-')
);
console.log('Editor stores:', editorStores);
</script>
```

</Tab>
</Tabs>

#### Events

The library dispatches custom events when stores are registered or unregistered:

**veltCrdtStoreRegister**

Fired when a new store is registered.

- Event Detail: `{ id: string }` // Store ID

<Tabs>
<Tab title="React / Next.js">

```jsx
window.addEventListener('veltCrdtStoreRegister', (event) => {
  console.log('Store registered:', event.detail.id);
  const store = window.VeltCrdtStoreMap.get(event.detail.id);
  // Do something with the new store
});
```

</Tab>
<Tab title="Other Frameworks">

```html
<script>
window.addEventListener('veltCrdtStoreRegister', (event) => {
  console.log('Store registered:', event.detail.id);
  const store = window.VeltCrdtStoreMap.get(event.detail.id);
  // Do something with the new store
});
</script>
```

</Tab>
</Tabs>

**veltCrdtStoreUnregister**

Fired when a store is unregistered (destroyed).

- Event Detail: `{ id: string }` // Store ID

<Tabs>
<Tab title="React / Next.js">

```jsx
window.addEventListener('veltCrdtStoreUnregister', (event) => {
  console.log('Store unregistered:', event.detail.id);
});
```

</Tab>
<Tab title="Other Frameworks">

```html
<script>
window.addEventListener('veltCrdtStoreUnregister', (event) => {
  console.log('Store unregistered:', event.detail.id);
});
</script>
```

</Tab>
</Tabs>