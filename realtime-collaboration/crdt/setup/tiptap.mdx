---
title: Tiptap Editor
description: Setup CRDT for Tiptap Editor.
---

This enables live cursors and collaborative editing out of the box. This is framework agnostic and can be used with any Tiptap editor.

## Prerequisites

- Node.js (v14 or higher)
- React (v16.8 or higher for hooks)
- A Velt account with an API key ([sign up](https://velt.dev))
- Optional: TypeScript for type safety

## Step 1: Install Dependencies

First, install the required packages:

```bash
npm install @veltdev/tiptap-crdt @tiptap/react @tiptap/starter-kit @tiptap/extension-collaboration @tiptap/extension-collaboration-cursor
```


## Step 2: Setup Velt

Initialize the Velt client by wrapping your app with the `VeltProvider`. This enables authentication and collaboration features. See [Velt Setup Docs](/get-started/setup/install) for details.

```jsx
import { VeltProvider } from '@veltdev/react';

export function Root() {
  return (
    <VeltProvider apiKey="YOUR_API_KEY">
      <App />
    </VeltProvider>
  );
}
```


## Step 3: Import Required Components

Import all necessary components and hooks:

```jsx
import CollaborationCursor from '@tiptap/extension-collaboration-cursor';
import { EditorContent, useEditor } from '@tiptap/react';
import StarterKit from '@tiptap/starter-kit';
import { useVeltClient, useVeltEventCallback } from '@veltdev/react';
import { VeltTipTapStore, createVeltTipTapStore } from '@veltdev/tiptap-crdt';
import { User } from '@veltdev/types';
import React, { useEffect, useRef, useState } from 'react';
```

## Step 4: Setup Component State

Create the necessary state variables and refs:

```jsx
const CollaborativeEditor: React.FC = () => {
  // Store reference to hold the VeltTipTap store instance
  const veltTiptapStoreRef = useRef<VeltTipTapStore | null>(null);

  // Get Velt client and user from Velt hooks. Velt User will be used to generate the live text cursors.
  const { client } = useVeltClient();
  const veltUser = useVeltEventCallback('userUpdate');

  // Track when the store is ready for editor initialization
  const [veltTiptapStoreReady, setVeltTiptapStoreReady] = useState(false);
```

## Step 5: Initialize the VeltTipTap Store

Initialize the store with a unique `editorId` and your Velt client, track readiness, and clean up on unmount.

```jsx
  // Initialize the VeltTipTap store when client and user are available
  useEffect(() => {
    if (!veltUser || !client) return;

    initializeStore();

    // Cleanup function to destroy store when component unmounts
    return () => {
      if (veltTiptapStoreRef.current) {
        veltTiptapStoreRef.current.destroy();
      }
    };
  }, [client, veltUser]);

  const initializeStore = async () => {
    // Create the VeltTipTap store with unique editor ID and Velt client
    const veltTiptapStore = await createVeltTipTapStore({ 
      editorId: 'my-collaborative-editor', // Unique identifier for this editor
      veltClient: client! 
    });
    
    veltTiptapStoreRef.current = veltTiptapStore;
    setVeltTiptapStoreReady(true);
  }
```

## Step 6: Configure the TipTap Editor

- Set up the editor with collaboration extensions.
- Add the collaboration extension from the VeltTipTap store when the store is ready.
- Configure cursor tracking with the same provider and Velt User.
- Disable default history to prevent conflicts.


```jsx
  // Initialize TipTap editor with collaboration extensions
  const editor = useEditor({
    extensions: [
      // Basic TipTap extensions
      StarterKit.configure({
        history: false, // Disable default history to prevent conflicts
      }),
      // Add collaboration extensions only when store is ready
      ...(
        veltTiptapStoreRef.current ?
          [
            // Get the collaboration extension from the VeltTipTap store
            veltTiptapStoreRef.current.getCollabExtension(),
            // Configure cursor tracking with the same provider
            CollaborationCursor.configure({
              provider: veltTiptapStoreRef.current.getStore().getProvider(),
              user: veltUser as User,
            }),
          ]
          : []
      ),
    ],
    // Start with empty content to avoid conflicts with YJS initialization
    content: ''
  }, [veltTiptapStoreReady, veltUser]); // Re-initialize when store is ready or user changes
```

## Step 7: Render the Editor

```jsx
  if (!editor) {
    return <div className="status">Loading editorâ€¦</div>;
  }

  return (
    <div className="editor-container">
      <div className="editor-header">
        Collaborative Editor - {veltUser?.name ? `Editing as ${veltUser.name}` : 'Please login to start editing'}
      </div>
      <div className="editor-content">
        <EditorContent editor={editor} />
      </div>
      <div className="status">
        {veltTiptapStoreReady ? 'Connected to collaborative session' : 'Connecting to collaborative session...'}
      </div>
    </div>
  );
};

export default CollaborativeEditor;
```

Add minimal styles to your app's stylesheet:

```css
.editor-container {
  padding: 20px;
}
.editor-header {
  font-size: 1.2em;
  margin-bottom: 10px;
}
.editor-content {
  border: 1px solid #ccc;
  padding: 10px;
  min-height: 200px;
}
.status {
  margin-top: 10px;
  color: #666;
}
```

## Testing and Debugging

To test collaboration:
1. Open two browser windows with different user sessions.
2. Edit in one window and verify changes and cursors appear in the other.

Common issues:
- Cursors not appearing: Ensure each editor has a unique `editorId` and users are authenticated.
- Editor not loading: Confirm the Velt client is initialized and the API key is valid.
- Desynced content: Make sure TipTap `history` is disabled when using collaboration.

## Complete Example

Here's the full implementation:

```jsx expandable lines
import CollaborationCursor from '@tiptap/extension-collaboration-cursor';
import { EditorContent, useEditor } from '@tiptap/react';
import StarterKit from '@tiptap/starter-kit';
import { useVeltClient, useVeltEventCallback } from '@veltdev/react';
import { VeltTipTapStore, createVeltTipTapStore } from '@veltdev/tiptap-crdt';
import { User } from '@veltdev/types';
import React, { useEffect, useRef, useState } from 'react';

const CollaborativeEditor: React.FC = () => {
  // Create a ref to hold our store instance
  const veltTiptapStoreRef = useRef<VeltTipTapStore | null>(null);

  const { client } = useVeltClient();

  const veltUser = useVeltEventCallback('userUpdate');

  // Initialize the store
  useEffect(() => {
    if (!veltUser || !client) return;

    initializeStore();

    // Clean up when the component unmounts
    return () => {
      if (veltTiptapStoreRef.current) {
        veltTiptapStoreRef.current.destroy();
      }
    };
  }, [client, veltUser]);

  const initializeStore = async () => {
    const veltTiptapStore = await createVeltTipTapStore({ editorId: 'velt-tiptap-crdt-demo', veltClient: client! });
    veltTiptapStoreRef.current = veltTiptapStore;
    setVeltTiptapStoreReady(true);
  }

  // Track when the store is ready
  const [veltTiptapStoreReady, setVeltTiptapStoreReady] = useState(false);

  // Initialize the editor with our collaboration extension
  const editor = useEditor({
    extensions: [
      StarterKit.configure({
        history: false, // Disables default history to use Collaboration's history management
      }),
      ...(
        veltTiptapStoreRef.current ?
          [
            // Use ONLY the collaboration extension from the store
            // This already handles the Firestore sync internally
            veltTiptapStoreRef.current.getCollabExtension(),
            // Configure the cursor with the same provider
            CollaborationCursor.configure({
              // Use the provider from the store
              provider: veltTiptapStoreRef.current.getStore().getProvider(),
              user: veltUser as User,
            }),
          ]
          : []
      ),
    ],
    // Set initial content directly to avoid conflicts with YJS initialization
    content: ''
  }, [veltTiptapStoreReady, veltUser]); // Re-initialize when store is ready

  return (
    <div className="editor-container">
      <div className="editor-header">
        Collaborative Editor - {veltUser?.name ? `Editing as ${veltUser.name}` : 'Please login to start editing'}
      </div>
      <div className="editor-content">
        <EditorContent editor={editor} />
      </div>
      <div className="status">
        {veltTiptapStoreReady ? 'Connected to collaborative session' : 'Connecting to collaborative session...'}
      </div>
    </div>
  );
};
export default CollaborativeEditor;
```

<Frame>
  <iframe
    src="https://velt-tiptap-crdt-demo.vercel.app/"
    className="w-full"
    height="500px"
  ></iframe>
</Frame>

[Open in larger window](https://velt-tiptap-crdt-demo.vercel.app/)

## Key Points

- **Unique editorId**: Use a unique `editorId` per editor instance.
- **Disable history**: Turn off TipTap `history` when using collaboration.
- **Initialize and clean up**: Create the VeltTipTap store after auth and destroy it on unmount.
- **Auth required**: Ensure the Velt client is initialized and user is available before starting.


