# 3.0.37

### Bug Fixes

- [**Notifications**]: Fixed an issue where the `unreadCommentsMap` count was not updating correctly when switching between documents with no unread comments.



# 3.0.36

### New Features

- [**Comments**]: Added ability to apply custom filtering, sorting and grouping in comments sidebar.
  - Here is the overview on how it works:
    - Enable custom filter mode in the comments sidebar.
    - Add action buttons to the sidebar wireframe.
    - Implement callback and event handlers to handle custom filtering, sorting, and grouping logic.
    - Set custom filtered data in the comments sidebar.
  - Here are the steps to implement it:

<Steps titleSize="h2">
  <Step title="Enable custom filter mode">
    <Tabs>
      <Tab title="React / Next.js">
        ```jsx
        <VeltCommentsSidebar customFilterMode={true} />
        ```
      </Tab>
      <Tab title="HTML / Other Frameworks">
        ```html
        <velt-comments-sidebar custom-filter-mode="true"></velt-comments-sidebar>
        ```
      </Tab>
    </Tabs>
  </Step>

  <Step title="Add action buttons to the sidebar wireframe">
    - Specify an `id` to the action button. This can be used to identify which button was clicked/toggled in the callback or lifecycle events.
    - There are two types of action buttons available:
      - `toggle`: This button has on and off states. This can be used to enable `AND` logic.
      - `default`: This button has only one state. This can be used to take action on click eg: sort, filter or group by a field.
    <Tabs>
      <Tab title="React / Next.js">
        ```jsx
        <VeltCommentsSidebarWireframe.ActionButton id="all" type="toggle" />
        ```
      </Tab>
      <Tab title="HTML / Other Frameworks">
        ```html
        <velt-comments-sidebar-action-button-wireframe id="unread" type="toggle">
        </velt-comments-sidebar-action-button-wireframe>
        ```
      </Tab>
    </Tabs>
  </Step>

  <Step title="Set default actions">
    - Set default custom sorting and filtering options in the comments sidebar.
    ```javascript
    commentElement.setCommentSidebarDefaultActionsConfig({
      'all': true,
      'unread': false,
      'mentions': false,
      'current-clip': false
    });
    ```
  </Step>

  <Step title="Implement custom filtering, sorting, and grouping logic">
  - Handle lifecycle and click events to implement custom filtering, sorting, and grouping logic:
    - `onCommentSidebarActionButtonClick`: Triggered when an action button is clicked.
    - `onCommentSidebarInit`: Triggered when the comments sidebar is initialized.
    - `onCommentSidebarData`: Triggered when the comments sidebar data is updated.
    - `setCommentSidebarData`: To set custom filtered data in the comments sidebar after applying custom logic.


  - Data type returned in the above events/lifecycle methods:
    ```javascript
    CommentSidebarActionsConfig {
      [key: string]: boolean; // Custom Action Button ID you defined in the wireframe
    }
    CommentSidebarDataConfig {
      actions: CommentSidebarActionsConfig; // Map of custom action button IDs and their states
      data: CommentAnnotation[]; // List of all unfiltered CommentAnnotations available in the comments sidebar
      unreadDataMap: { [commentAnnotationId: string]: number }; // Map of comment annotation id and the number of unread comments it has
      systemFilteredData: CommentAnnotation[]; // List of filtered CommentAnnotations based on system filters
    }
    ```

    <Tabs>
      <Tab title="React / Next.js">
        ```jsx
        import { useCommentSidebarActionButtonClick, useCommentSidebarInit, useCommentSidebarData } from '@veltdev/react';

        const commentSidebarActionButtonClickData: CommentSidebarDataConfig = useCommentSidebarActionButtonClick();
        const commentSidebarInitData: CommentSidebarDataConfig = useCommentSidebarInit();
        const commentSidebarData: CommentSidebarDataConfig = useCommentSidebarData();

        useEffect(() => {
          if (commentSidebarActionButtonClick) {
            // Custom Filtering | Sorting | Grouping Logic
          }
        }, [commentSidebarActionButtonClickData]);

        useEffect(() => {
          if (commentSidebarInit) {
            // Custom Filtering | Sorting | Grouping Logic
          }
        }, [commentSidebarInitData]);

        useEffect(() => {
          if (commentSidebarData) {
            // Custom Filtering | Sorting | Grouping Logic
          }
        }, [commentSidebarData]);
        ```
      </Tab>
      <Tab title="HTML / Other Frameworks">
        ```javascript
        commentElement.onCommentSidebarActionButtonClick().subscribe((data) => {
          // Custom Filtering | Sorting | Grouping Logic
        });

        commentElement.onCommentSidebarInit().subscribe((data) => {
          // Custom Filtering | Sorting | Grouping Logic
        });

        commentElement.onCommentSidebarData().subscribe((data) => {
          // Custom Filtering | Sorting | Grouping Logic
        });
        ```
      </Tab>
    </Tabs>
  </Step>

  <Step title="Set custom filtered data">
  - Once you have applied your custom filtering, sorting, and grouping logic, create the data as `CommentSidebarData[]` type and set it in the comments sidebar:
    ```javascript
    CommentSidebarData {
      type: 'group';
      data: {
        displayName: string; // Name of the group
        isExpanded: boolean; // Whether the group is expanded
        annotations: CommentAnnotation[]; // List of CommentAnnotations in the group
      }
    }
    ```
    <Tabs>
      <Tab title="React / Next.js">
        ```jsx
        commentUtils?.setCommentSidebarData(customFilterData);
        ```
      </Tab>
      <Tab title="HTML / Other Frameworks">
        ```javascript
        commentElement.setCommentSidebarData(customFilterData);
        ```
      </Tab>
    </Tabs>
  </Step>
</Steps>

- [**Comments**]: Added shadowDOM, dark mode, and variant support in standalone Comment Thread component.
  <Tabs>
    <Tab title="React / Next.js">
      ```jsx
      <VeltCommentThread 
        darkMode={true}
        shadowDom={false}
        variant="component-variant" 
        dialogVariant="dialog-variant"
      />
      ```
    </Tab>
    <Tab title="HTML / Other Frameworks">
      ```html
      <velt-comment-thread 
        dark-mode="true" 
        shadow-dom="false"
        dialog-variant="dialog-variant"
        variant="component-variant"
      ></velt-comment-thread> 
      ```
    </Tab>
  </Tabs>

### Bug Fixes

- [**Comments**]: Fixed an issue where scroll was causing the "Add reply" button to hide.
- [**Comments**]: Fixed an issue where the assign to dialog was not closing after assigning a user using the keyboard.
