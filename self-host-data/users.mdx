---
title: "Users"
description: "Self-host your users' PII while using Velt's collaboration features. Keep sensitive user data on your infrastructure with only user IDs stored on Velt servers."
---

<Warning>
Ensure that the data providers are set prior to calling `identify` method.
</Warning>

# Overview
Velt supports self-hosting your users' personally identifiable information (PII):

- Only the userId is stored on Velt servers, keeping sensitive user metadata on your infrastructure
- Velt Components automatically hydrate user details in the frontend by fetching from your configured data provider
- This gives you full control over user data while maintaining all Velt functionality

## How does it work?
- When the SDK is initialized, it will call the [`UserDataProvider`](/api-reference/sdk/models/data-models#userdataprovider) you configure with the list of userIds that it needs to fetch for the currently set user, organization, document, etc.
- The [`UserDataProvider`](/api-reference/sdk/models/data-models#userdataprovider) takes in a list of userIds and returns a Record object with the userIds as keys and the user data as values.

Here are the methods that you need to implement on the data provider:
## get
Method to fetch users from your database.
- Param: `string[]`: Array of userIds to fetch
- Return: `Promise<Record<string, User>>`

<Tabs>
<Tab title="Frontend Example">
<CodeGroup>
```jsx React / Next.js
const fetchUsersFromDB = async (userIds) => {
  const response = await fetch('/api/velt/users/get', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ userIds })
  });
  return await response.json();
};

const userDataProvider = {
  get: fetchUsersFromDB,
};

<VeltProvider
  apiKey='YOUR_API_KEY'
  dataProviders={{ user: userDataProvider }}
>
</VeltProvider>
```

```js Other Frameworks
const fetchUsersFromDB = async (userIds) => {
  const response = await fetch('/api/velt/users/get', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ userIds })
  });
  return await response.json();
};

const userDataProvider = {
  get: fetchUsersFromDB,
};

Velt.setDataProviders({ user: userDataProvider });
```
</CodeGroup>
</Tab>
<Tab title="Backend Endpoint Example (MongoDB)">
```javascript
const { userIds } = req.body;

const users = await collection.find({
  userId: { $in: userIds }
}).toArray();

// Convert to Record<userId, User>
const result = {};
for (const user of users) {
  result[user.userId] = user;
}

// Return response in required format
res.json(result);
```
</Tab>
<Tab title="Backend Endpoint Example (PostgreSQL)">
```javascript
const { userIds } = req.body;

const { rows } = await client.query(
  'SELECT user_id, name, email, photo_url FROM users WHERE user_id = ANY($1)',
  [userIds]
);

// Convert to Record<userId, User>
const result = {};
for (const row of rows) {
  result[row.user_id] = {
    userId: row.user_id,
    name: row.name,
    email: row.email,
    photoUrl: row.photo_url
  };
}

// Return response in required format
res.json(result);
```
</Tab>
</Tabs>

## config
Configuration for the user data provider.
- Type: [`ResolverConfig`](/api-reference/sdk/models/data-models#resolverconfig). Relevant properties:
  - `resolveUsersConfig`: [`ResolveUsersConfig`](/api-reference/sdk/models/data-models#resolveusersconfig). Controls whether Velt issues user-resolver requests during initialization to fetch contact lists at the organization, folder, and document levels. Use this to optimize performance in environments with a large number of users by preventing unnecessary user-data fetches. You can selectively disable user-resolver requests for specific scopes and instead provide your own user data via the [custom autocomplete feature](/async-collaboration/comments/customize-behavior#customautocompletesearch) instead.
      - `organization`: boolean - Enable/disable user requests for organization users (default: true)
      - `document`: boolean - Enable/disable user requests for document users (default: true)
      - `folder`: boolean - Enable/disable user requests for folder users (default: true)

```jsx
const userConfig = {
  resolveUsersConfig: {
    organization: false,
    folder: false,
    document: true
  }
};
```

# Example Implementation

<Tabs>
<Tab title="React / Next.js">
``` jsx
const fetchUsersFromDB = async (userIds) => {
  const response = await fetch('/api/velt/users/get', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ userIds })
  });
  return await response.json();
};

const userDataProvider = {
  get: fetchUsersFromDB,
  config: {
    resolveUsersConfig: {
      organization: false,
      folder: false,
      document: true
    }
  }
};

<VeltProvider
  apiKey='YOUR_API_KEY'
  dataProviders={{ user: userDataProvider }}
>
</VeltProvider>
```
</Tab>
<Tab title="Other Frameworks">
``` js
const fetchUsersFromDB = async (userIds) => {
  const response = await fetch('/api/velt/users/get', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ userIds })
  });
  return await response.json();
};

const userDataProvider = {
  get: fetchUsersFromDB,
  config: {
    resolveUsersConfig: {
      organization: false,
      folder: false,
      document: true
    }
  }
};

Velt.setDataProviders({ user: userDataProvider });
```
</Tab>
</Tabs>

# Sample Data

<Tabs>
<Tab title="Stored on your database">
```json
{
    "USER_ID_1": {
        "userId": "USER_ID_1",
        "name": "John Doe",
        "email": "john.doe@example.com",
        "photoUrl": "https://example.com/photos/john.jpg",
        "organizationId": "ORG_ID",
        "role": "admin"
    },
    "USER_ID_2": {
        "userId": "USER_ID_2",
        "name": "Jane Smith",
        "email": "jane.smith@example.com",
        "photoUrl": "https://example.com/photos/jane.jpg",
        "organizationId": "ORG_ID",
        "role": "member"
    }
};

Velt.setDataProviders({
    user: userDataProvider
});
```
</Tab>
</Tabs>

## Debugging

You can subscribe to `dataProvider` events to monitor and debug get operations:

<Tabs>
<Tab title="React / Next.js">
```jsx
import { useVeltClient } from '@veltdev/react';

const { client } = useVeltClient();

useEffect(() => {
  if (!client) return;

  const subscription = client.on('dataProvider').subscribe((event) => {
    console.log('Data Provider Event:', event);
  });

  return () => subscription?.unsubscribe();
}, [client]);
```
</Tab>

<Tab title="Other Frameworks">
```javascript
const subscription = Velt.on('dataProvider').subscribe((event) => {
  console.log('Data Provider Event:', event);
});

// Unsubscribe when done
subscription?.unsubscribe();
```
</Tab>
</Tabs>
